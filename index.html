<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Estate Market Explorer</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --bg: #080b12; --surface: #0f1117; --surface2: #1a1e2e; --border: #2a2d3a;
    --muted: #334155; --subtle: #475569; --text: #e2e8f0; --text-dim: #94a3b8;
    --accent: #38bdf8; --accent2: #818cf8; --danger: #f87171;
  }
  body { background: var(--bg); color: var(--text); font-family: 'DM Mono', monospace; min-height: 100vh; padding: 32px 24px; }
  ::-webkit-scrollbar { width: 5px; background: var(--surface); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  .header { margin-bottom: 28px; display: flex; justify-content: space-between; align-items: flex-start; }
  .header-left { }
  .header-logo { height: 64px; width: auto; opacity: 0.9; }
  .header h1 {
    font-family: 'Syne', sans-serif; font-size: clamp(22px,4vw,34px); font-weight: 800;
    letter-spacing: -0.02em; background: linear-gradient(90deg,var(--accent),var(--accent2));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 6px;
  }
  .header p { color: var(--subtle); font-size: 11px; letter-spacing: 0.12em; }

  /* State picker */
  .state-screen { max-width: 700px; margin: 0 auto; }
  .state-screen h2 { font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 700; color: var(--text); margin-bottom: 6px; }
  .state-screen p { font-size: 11px; color: var(--subtle); letter-spacing: 0.08em; margin-bottom: 24px; }
  .state-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(58px, 1fr));
    gap: 8px;
  }
  .state-btn {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 6px;
    font-family: inherit;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-dim);
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
    letter-spacing: 0.05em;
  }
  .state-btn:hover { border-color: var(--accent); color: var(--accent); background: rgba(56,189,248,0.06); }
  .state-btn.active { border-color: var(--accent); color: #080b12; background: var(--accent); }

  /* Loading */
  .progress-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 32px 24px; text-align: center; max-width: 480px; margin: 0 auto; }
  .progress-label { font-size: 13px; color: var(--text-dim); margin-bottom: 16px; }
  .progress-bar-bg { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
  .progress-bar-fill { height: 100%; background: linear-gradient(90deg,var(--accent),var(--accent2)); border-radius: 2px; transition: width 0.3s; width: 0%; }

  /* Mode toggle */
  .top-bar { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; flex-wrap: wrap; }
  .mode-toggle { display: inline-flex; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 3px; gap: 2px; }
  .mode-btn { padding: 7px 20px; font-family: inherit; font-size: 11px; letter-spacing: 0.1em; border: none; border-radius: 6px; cursor: pointer; transition: all 0.15s; background: transparent; color: var(--subtle); }
  .mode-btn.active { background: var(--accent); color: #080b12; font-weight: 500; }
  .change-state-btn {
    background: transparent; border: 1px solid var(--border); border-radius: 6px;
    color: var(--subtle); font-family: inherit; font-size: 11px; padding: 7px 14px;
    cursor: pointer; letter-spacing: 0.08em; transition: all 0.15s;
  }
  .change-state-btn:hover { border-color: var(--accent); color: var(--accent); }
  .state-badge {
    font-size: 11px; color: var(--accent2); letter-spacing: 0.1em;
    background: rgba(129,140,248,0.1); border: 1px solid rgba(129,140,248,0.2);
    border-radius: 6px; padding: 7px 12px;
  }

  /* Controls */
  .controls { display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 24px; align-items: flex-start; }
  .control-group { flex: 1 1 240px; max-width: 380px; }
  .control-label { font-size: 10px; color: var(--subtle); letter-spacing: 0.12em; margin-bottom: 6px; }
  .select-box { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; cursor: pointer; font-size: 13px; color: var(--text); display: flex; justify-content: space-between; align-items: center; user-select: none; transition: border-color 0.15s; }
  .select-box:hover { border-color: var(--accent); }
  .select-box.placeholder { color: var(--subtle); }
  .select-arrow { color: var(--subtle); font-size: 10px; flex-shrink: 0; margin-left: 8px; }
  .select-wrapper { position: relative; }
  .dropdown { position: absolute; top: calc(100% + 4px); left: 0; right: 0; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; z-index: 1000; max-height: 320px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 12px 40px rgba(0,0,0,0.6); }
  .dropdown-search { background: var(--surface2); border: none; border-bottom: 1px solid var(--border); padding: 10px 14px; color: var(--text); font-size: 12px; font-family: inherit; outline: none; }
  .dropdown-list { overflow-y: auto; flex: 1; }
  .dropdown-item { padding: 9px 14px; cursor: pointer; font-size: 12px; color: var(--text-dim); transition: background 0.1s,color 0.1s; display: flex; justify-content: space-between; align-items: center; }
  .dropdown-item:hover { background: var(--surface2); color: var(--accent); }
  .dropdown-item.active { background: var(--surface2); color: var(--accent); }
  .dropdown-item .sub { color: var(--muted); font-size: 10px; }
  .dropdown-empty { padding: 14px; color: var(--muted); font-size: 12px; text-align: center; }

  /* Content */
  .chart-card { background: #0a0d16; border: 1px solid var(--surface2); border-radius: 12px; padding: 24px 20px 20px; }
  .chart-title { font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
  .chart-subtitle { font-size: 11px; color: var(--subtle); margin-bottom: 20px; }
  .chart-wrap { position: relative; height: 300px; }
  .stats-row { display: flex; gap: 28px; flex-wrap: wrap; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--surface2); }
  .stat-label { font-size: 9px; color: var(--muted); letter-spacing: 0.12em; margin-bottom: 3px; }
  .stat-value { font-size: 15px; color: var(--accent); font-weight: 500; }

  .empty-state { border: 1px dashed var(--surface2); border-radius: 12px; padding: 80px 24px; text-align: center; color: var(--muted); font-size: 13px; }

  .export-bar { display: flex; gap: 10px; margin-top: 16px; }
  .export-btn {
    background: var(--surface); border: 1px solid var(--border); border-radius: 7px;
    padding: 8px 16px; font-family: inherit; font-size: 11px; letter-spacing: 0.08em;
    color: var(--text-dim); cursor: pointer; transition: all 0.15s; display: flex; align-items: center; gap: 7px;
  }
  .export-btn:hover { border-color: var(--accent); color: var(--accent); }
  .export-btn svg { flex-shrink: 0; }

  /* Summary card (hidden, used for JPEG render) */
  #summary-card {
    position: fixed; left: -9999px; top: 0;
    width: 900px; background: #080b12; padding: 32px;
    font-family: 'DM Mono', monospace; color: #e2e8f0;
  }
  .sc-header { margin-bottom: 18px; border-bottom: 1px solid #2a2d3a; padding-bottom: 14px; }
  .sc-title { font-family: 'Syne', sans-serif; font-size: 26px; font-weight: 800;
    background: linear-gradient(90deg,#38bdf8,#818cf8);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 4px; }
  .sc-sub { font-size: 11px; color: #475569; letter-spacing: 0.1em; }
  .sc-date { font-size: 11px; color: #475569; margin-top: 4px; }
  .sc-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
  .sc-cell { background: #0f1117; border: 1px solid #1a1e2e; border-radius: 10px; padding: 12px 16px; }
  .sc-cell-label { font-size: 9px; color: #e2e8f0; letter-spacing: 0.1em; margin-bottom: 5px; text-transform: uppercase; }
  .sc-cell-value { font-size: 17px; color: #38bdf8; font-weight: 500; }
  .sc-footer { margin-top: 24px; padding-top: 16px; border-top: 1px solid #1a1e2e;
    font-size: 10px; color: #334155; letter-spacing: 0.08em; }

  #last-updated { font-size: 10px; color: var(--muted); margin-top: 20px; letter-spacing: 0.08em; }

  /* Screens */
  #state-screen { display: block; }
  #loading-screen { display: none; }
  #app-screen { display: none; }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <h1>Real Estate Market Explorer</h1>
    <p>REALTOR.COM INVENTORY DATA</p>
  </div>
  <img class="header-logo" src="data:image/png;base64,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" alt="AH Datalytics">
</div>

<!-- State picker -->
<div id="state-screen">
  <div class="state-screen">
    <h2>Select a State</h2>
    <p>CHOOSE A STATE TO LOAD COUNTY AND ZIP CODE DATA</p>
    <div class="state-grid" id="state-grid"></div>
  </div>
</div>

<!-- Loading -->
<div id="loading-screen">
  <div class="progress-wrap">
    <div class="progress-label" id="loading-label">Loading...</div>
    <div class="progress-bar-bg"><div class="progress-bar-fill" id="progress-bar"></div></div>
    <div id="loading-sub" style="font-size:11px;color:var(--muted);margin-top:12px;"></div>
  </div>
</div>

<!-- App -->
<div id="app-screen">
  <div class="top-bar">
    <div class="mode-toggle">
      <button class="mode-btn active" id="btn-county" onclick="switchMode('county')">COUNTY</button>
      <button class="mode-btn" id="btn-zip" onclick="switchMode('zip')">ZIP CODE</button>
    <button class="mode-btn" id="btn-rent-county" onclick="switchMode('rent-county')">RENT (COUNTY)</button>
    <button class="mode-btn" id="btn-rent-zip" onclick="switchMode('rent-zip')">RENT (ZIP)</button>
    </div>
    <div class="state-badge" id="state-badge">TX</div>
    <button class="change-state-btn" onclick="changeState()">&#8592; Change State</button>
  </div>

  <div class="controls">
    <div class="control-group">
      <div class="control-label" id="geo-label">COUNTY</div>
      <div class="select-wrapper" id="geo-wrapper">
        <div class="select-box placeholder" id="geo-box" onclick="toggleDropdown('geo')">
          <span id="geo-selected-label">Select a county...</span>
          <span class="select-arrow">&#9660;</span>
        </div>
        <div class="dropdown" id="geo-dropdown" style="display:none">
          <input class="dropdown-search" id="geo-search" placeholder="Search..." oninput="filterGeoList()" autocomplete="off">
          <div class="dropdown-list" id="geo-list"></div>
        </div>
      </div>
    </div>

    <div class="control-group">
      <div class="control-label">METRIC</div>
      <div class="select-wrapper" id="metric-wrapper">
        <div class="select-box placeholder" id="metric-box" onclick="toggleDropdown('metric')">
          <span id="metric-label" style="color:var(--subtle)">Select a metric...</span>
          <span class="select-arrow">&#9660;</span>
        </div>
        <div class="dropdown" id="metric-dropdown" style="display:none">
          <div class="dropdown-list" id="metric-list"></div>
        </div>
      </div>
    </div>

    <div class="control-group" id="export-bar" style="display:none;flex:0 0 auto;align-self:flex-end;">
      <div class="control-label">OVERVIEW REPORT</div>
      <div style="display:flex;gap:8px;">
        <button class="export-btn" onclick="exportCSV()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          CSV
        </button>
        <button class="export-btn" onclick="exportJPEG()">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
          JPEG
        </button>
      </div>
    </div>
  </div>

  <div id="summary-sentence" style="display:none;margin-bottom:18px;padding:14px 18px;background:var(--surface);border:1px solid var(--border);border-radius:10px;font-size:13px;line-height:1.7;color:var(--text-dim);"></div>

  <div id="main-layout" style="display:none">
    <div id="chart-panel">
      <div class="empty-state" style="height:300px;display:flex;align-items:center;justify-content:center;">Select a location to begin exploring</div>
    </div>
  </div>
  <div id="empty-state-msg">
    <div class="empty-state">Select a location to begin exploring</div>
  </div>
  <div id="last-updated"></div>
</div>

<!-- Summary card for JPEG export (off-screen) -->
<div id="summary-card"></div>

<script>
const STATES = [
  'AL','AK','AZ','AR','CA','CO','CT','DE','DC','FL','GA','HI','ID','IL','IN',
  'IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH',
  'NJ','NM','NY','NC','ND','OH','OK','OR','PA','PR','RI','SC','SD','TN','TX',
  'UT','VT','VA','WA','WV','WI','WY'
];

const STATE_NAMES = {
  AL:'Alabama',AK:'Alaska',AZ:'Arizona',AR:'Arkansas',CA:'California',CO:'Colorado',
  CT:'Connecticut',DE:'Delaware',DC:'District of Columbia',FL:'Florida',GA:'Georgia',
  HI:'Hawaii',ID:'Idaho',IL:'Illinois',IN:'Indiana',IA:'Iowa',KS:'Kansas',KY:'Kentucky',
  LA:'Louisiana',ME:'Maine',MD:'Maryland',MA:'Massachusetts',MI:'Michigan',MN:'Minnesota',
  MS:'Mississippi',MO:'Missouri',MT:'Montana',NE:'Nebraska',NV:'Nevada',NH:'New Hampshire',
  NJ:'New Jersey',NM:'New Mexico',NY:'New York',NC:'North Carolina',ND:'North Dakota',
  OH:'Ohio',OK:'Oklahoma',OR:'Oregon',PA:'Pennsylvania',PR:'Puerto Rico',RI:'Rhode Island',
  SC:'South Carolina',SD:'South Dakota',TN:'Tennessee',TX:'Texas',UT:'Utah',VT:'Vermont',
  VA:'Virginia',WA:'Washington',WV:'West Virginia',WI:'Wisconsin',WY:'Wyoming'
};

const METRICS = [
  { key:"active_listing_count", label:"Active Listing Count", format:"number" },
  { key:"active_listing_count_mm", label:"Active Listings (M/M %)", format:"percent" },
  { key:"active_listing_count_yy", label:"Active Listings (Y/Y %)", format:"percent" },
  { key:"average_listing_price", label:"Average Listing Price", format:"currency" },
  { key:"average_listing_price_mm", label:"Average Listing Price (M/M %)", format:"percent" },
  { key:"average_listing_price_yy", label:"Average Listing Price (Y/Y %)", format:"percent" },
  { key:"median_days_on_market_mm", label:"Days on Market (M/M %)", format:"percent" },
  { key:"median_days_on_market", label:"Days on Market (Median)", format:"number" },
  { key:"median_days_on_market_yy", label:"Days on Market (Y/Y %)", format:"percent" },
  { key:"median_listing_price", label:"Median Listing Price", format:"currency" },
  { key:"median_listing_price_mm", label:"Median Listing Price (M/M %)", format:"percent" },
  { key:"median_listing_price_yy", label:"Median Listing Price (Y/Y %)", format:"percent" },
  { key:"median_listing_price_per_square_foot", label:"Median Price Per Sq Ft", format:"currency" },
  { key:"median_listing_price_per_square_foot_mm", label:"Median Price Per Sq Ft (M/M %)", format:"percent" },
  { key:"median_listing_price_per_square_foot_yy", label:"Median Price Per Sq Ft (Y/Y %)", format:"percent" },
  { key:"median_square_feet", label:"Median Square Feet", format:"number" },
  { key:"median_square_feet_mm", label:"Median Square Feet (M/M %)", format:"percent" },
  { key:"median_square_feet_yy", label:"Median Square Feet (Y/Y %)", format:"percent" },
  { key:"new_listing_count", label:"New Listing Count", format:"number" },
  { key:"new_listing_count_mm", label:"New Listings (M/M %)", format:"percent" },
  { key:"new_listing_count_yy", label:"New Listings (Y/Y %)", format:"percent" },
  { key:"pending_listing_count", label:"Pending Listing Count", format:"number" },
  { key:"pending_listing_count_mm", label:"Pending Listings (M/M %)", format:"percent" },
  { key:"pending_listing_count_yy", label:"Pending Listings (Y/Y %)", format:"percent" },
  { key:"pending_ratio", label:"Pending Ratio", format:"decimal" },
  { key:"pending_ratio_mm", label:"Pending Ratio (M/M %)", format:"percent" },
  { key:"pending_ratio_yy", label:"Pending Ratio (Y/Y %)", format:"percent" },
  { key:"price_increased_count", label:"Price Increased Count", format:"number" },
  { key:"price_increased_share", label:"Price Increased Share", format:"percent" },
  { key:"price_reduced_count", label:"Price Reduced Count", format:"number" },
  { key:"price_reduced_share", label:"Price Reduced Share", format:"percent" },
  { key:"total_listing_count", label:"Total Listing Count", format:"number" },
  { key:"total_listing_count_mm", label:"Total Listings (M/M %)", format:"percent" },
  { key:"total_listing_count_yy", label:"Total Listings (Y/Y %)", format:"percent" },
];

const FIPS_TO_STATE = {
  '01':'AL','02':'AK','04':'AZ','05':'AR','06':'CA','08':'CO','09':'CT','10':'DE',
  '11':'DC','12':'FL','13':'GA','15':'HI','16':'ID','17':'IL','18':'IN','19':'IA',
  '20':'KS','21':'KY','22':'LA','23':'ME','24':'MD','25':'MA','26':'MI','27':'MN',
  '28':'MS','29':'MO','30':'MT','31':'NE','32':'NV','33':'NH','34':'NJ','35':'NM',
  '36':'NY','37':'NC','38':'ND','39':'OH','40':'OK','41':'OR','42':'PA','44':'RI',
  '45':'SC','46':'SD','47':'TN','48':'TX','49':'UT','50':'VT','51':'VA','53':'WA',
  '54':'WV','55':'WI','56':'WY','72':'PR'
};


const RENT_METRICS = [
  { key:'zori',    label:'Zillow Observed Rent Index (ZORI)', format:'currency' },
  { key:'zori_mm', label:'ZORI (M/M %)',                      format:'percent'  },
  { key:'zori_yy', label:'ZORI (Y/Y %)',                      format:'percent'  },
];

function isRentMode() { return mode==='rent-county' || mode==='rent-zip'; }

// ── App state ──────────────────────────────────────────────────────────────
let selectedState = null;
let mode = 'county';
let countyMap = new Map(), countyDataMap = new Map();
let zipMap = new Map(), zipDataMap = new Map();
let rentCountyMap = new Map(), rentCountyDataMap = new Map();
let rentZipMap = new Map(), rentZipDataMap = new Map();
let countyLoaded = false, zipLoaded = false, rentCountyLoaded = false, rentZipLoaded = false;
let selectedGeoKey = null;
let selectedMetric = null;
let chartInstance = null;
let filteredGeoList = [];

// ── Helpers ────────────────────────────────────────────────────────────────
function titleCase(str) {
  const small = new Set(['a','an','the','and','but','or','for','nor','on','at','to','by','in','of','up','as','is']);
  return str.toLowerCase().split(/\s+/).map((w,i) =>
    (i===0||!small.has(w)) ? w.charAt(0).toUpperCase()+w.slice(1) : w
  ).join(' ');
}

function formatCountyName(rawName, fips) {
  const stateFips = String(fips).padStart(5,'0').slice(0,2);
  const stateAbbr = FIPS_TO_STATE[stateFips] || '';
  let name = rawName.replace(/,?\s+[a-zA-Z]{2}$/,'').trim();
  name = name.replace(/\s+County$/i,'').replace(/\s+Parish$/i,'').replace(/\s+Borough$/i,'')
             .replace(/\s+Census Area$/i,'').replace(/\s+Municipality$/i,'')
             .replace(/\s+City and Borough$/i,'').replace(/\s+Municipio$/i,'').trim();
  return stateAbbr ? titleCase(name)+', '+stateAbbr : titleCase(name);
}

function formatZipName(zipName, postalCode) {
  if (!zipName) return String(postalCode);
  const parts = String(zipName).split(',');
  const city = titleCase(parts[0].trim());
  const state = parts[1] ? parts[1].trim().toUpperCase() : '';
  return state ? city+', '+state+' ('+postalCode+')' : city+' ('+postalCode+')';
}


function formatValue(val, fmt) {
  if (val===null||val===undefined||val===''||isNaN(+val)) return 'N/A';
  const n = +val;
  if (fmt==='currency') return '$'+n.toLocaleString(undefined,{maximumFractionDigits:0});
  if (fmt==='percent') return (n*100).toFixed(1)+'%';
  if (fmt==='decimal') return n.toFixed(3);
  return n.toLocaleString(undefined,{maximumFractionDigits:1});
}
function formatDate(d) { const s=String(d).trim(); return s.slice(0,4)+'-'+s.slice(4,6); }

// ── State grid ─────────────────────────────────────────────────────────────
function buildStateGrid() {
  const grid = document.getElementById('state-grid');
  STATES.forEach(st => {
    const btn = document.createElement('button');
    btn.className = 'state-btn';
    btn.title = STATE_NAMES[st] || st;
    btn.textContent = st;
    btn.onclick = () => selectState(st);
    grid.appendChild(btn);
  });
}

function selectState(st) {
  selectedState = st;
  document.querySelectorAll('.state-btn').forEach(b => b.classList.toggle('active', b.textContent === st));
  // Reset everything
  countyMap.clear(); countyDataMap.clear();
  zipMap.clear(); zipDataMap.clear();
  rentCountyMap.clear(); rentCountyDataMap.clear();
  rentZipMap.clear(); rentZipDataMap.clear();
  countyLoaded = false; zipLoaded = false; rentCountyLoaded = false; rentZipLoaded = false;
  selectedGeoKey = null;
  mode = 'county';
  // Update badge
  document.getElementById('state-badge').textContent = st + ' — ' + (STATE_NAMES[st]||st);
  document.getElementById('btn-county').classList.add('active');
  ['zip','rent-county','rent-zip'].forEach(m => document.getElementById('btn-'+m).classList.remove('active'));
  document.getElementById('geo-label').textContent = 'COUNTY';
  document.getElementById('geo-selected-label').textContent = 'Select a county...';
  document.getElementById('geo-box').classList.add('placeholder');
  document.getElementById('main-layout').style.display = 'none';
  document.getElementById('empty-state-msg').style.display = '';
  document.getElementById('export-bar').style.display = 'none';
  document.getElementById('summary-sentence').style.display = 'none';
  loadDataset('county');
}

function changeState() {
  document.getElementById('state-screen').style.display = 'block';
  document.getElementById('app-screen').style.display = 'none';
  document.getElementById('loading-screen').style.display = 'none';
}

// ── Loading ────────────────────────────────────────────────────────────────
function loadDataset(which) {
  if (which==='county' && countyLoaded) { showApp(); return; }
  if (which==='zip' && zipLoaded) { showApp(); return; }
  if (which==='rent-county' && rentCountyLoaded) { showApp(); return; }
  if (which==='rent-zip' && rentZipLoaded) { showApp(); return; }

  document.getElementById('state-screen').style.display = 'none';
  document.getElementById('app-screen').style.display = 'none';
  document.getElementById('loading-screen').style.display = 'block';

  const label = document.getElementById('loading-label');
  const bar = document.getElementById('progress-bar');
  bar.style.width = '0%';
  bar.style.background = 'linear-gradient(90deg,var(--accent),var(--accent2))';
  document.getElementById('loading-sub').textContent = '';
  label.textContent = 'Loading ' + selectedState + ' ' + which + ' data...';

  const pathMap = {
    'county': 'data/county/' + selectedState + '.csv',
    'zip': 'data/zip/' + selectedState + '.csv',
    'rent-county': 'data/rent_county/' + selectedState + '.csv',
    'rent-zip': 'data/rent_zip/' + selectedState + '.csv'
  };
  const path = pathMap[which];
  let rowCount = 0;

  fetch(path)
    .then(res => {
      if (!res.ok) throw new Error('HTTP ' + res.status + ' — data not available for ' + selectedState);
      return res.text();
    })
    .then(text => {
      label.textContent = 'Parsing...';
      bar.style.width = '60%';
      Papa.parse(text, {
        header: true, dynamicTyping: true, skipEmptyLines: true,
        chunk(results) {
          rowCount += results.data.length;
          results.data.forEach(row => ingestRow(row, which));
        },
        complete() {
          bar.style.width = '100%';
          (which==='county'?countyDataMap:zipDataMap).forEach(rows=>rows.sort((a,b)=>+a.month_date_yyyymm - +b.month_date_yyyymm));
          if (which==='county') countyLoaded=true;
          else if (which==='zip') zipLoaded=true;
          else if (which==='rent-county') rentCountyLoaded=true;
          else rentZipLoaded=true;
          console.log('Loaded ' + (which==='county'?countyMap.size:zipMap.size) + ' ' + which + ' entries for ' + selectedState);
          setTimeout(showApp, 150);
        },
        error(err) { showError(err.message); }
      });
    })
    .catch(err => showError(err.message));
}

function showError(msg) {
  document.getElementById('loading-label').textContent = 'Error loading data';
  document.getElementById('progress-bar').style.background = '#f87171';
  document.getElementById('loading-sub').innerHTML =
    '<div style="color:var(--danger);margin-bottom:10px;">'+msg+'</div>' +
    '<button onclick="changeState()" style="background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:8px 16px;cursor:pointer;font-size:12px;color:var(--accent);font-family:inherit;">&#8592; Back to State Picker</button>';
}

function showApp() {
  document.getElementById('loading-screen').style.display = 'none';
  document.getElementById('state-screen').style.display = 'none';
  document.getElementById('app-screen').style.display = 'block';
  document.getElementById('last-updated').textContent = 'DATA LOADED ' + new Date().toUTCString();
  buildMetricList();
  refreshGeoList();
}

// ── Ingest ─────────────────────────────────────────────────────────────────
function ingestRow(row, which) {
  if (which==='county') {
    if (!row.county_fips||!row.county_name) return;
    const fips = String(row.county_fips);
    if (!countyMap.has(fips)) countyMap.set(fips, formatCountyName(row.county_name, row.county_fips));
    if (!countyDataMap.has(fips)) countyDataMap.set(fips,[]);
    countyDataMap.get(fips).push(row);
  } else if (which==='zip') {
    if (!row.postal_code) return;
    const zip = String(row.postal_code).padStart(5,'0');
    if (!zipMap.has(zip)) zipMap.set(zip, formatZipName(row.zip_name, zip));
    if (!zipDataMap.has(zip)) zipDataMap.set(zip,[]);
    zipDataMap.get(zip).push(row);
  } else if (which==='rent-county') {
    if (!row.RegionName || !row.RegionID) return;
    const key = String(row.RegionID);
    if (!rentCountyMap.has(key)) rentCountyMap.set(key, titleCase(row.RegionName) + ', ' + row.State);
    if (!rentCountyDataMap.has(key)) rentCountyDataMap.set(key,[]);
    rentCountyDataMap.get(key).push(row);
  } else if (which==='rent-zip') {
    if (!row.RegionName || !row.RegionID) return;
    const key = String(row.RegionID);
    const zip = String(row.RegionName).padStart(5,'0');
    const city = row.City ? titleCase(row.City) : '';
    const label = city ? city + ', ' + row.State + ' (' + zip + ')' : zip;
    if (!rentZipMap.has(key)) rentZipMap.set(key, label);
    if (!rentZipDataMap.has(key)) rentZipDataMap.set(key,[]);
    rentZipDataMap.get(key).push(row);
  }
}

// ── Mode switch ────────────────────────────────────────────────────────────
function switchMode(newMode) {
  const loaded = {
    'county': countyLoaded, 'zip': zipLoaded,
    'rent-county': rentCountyLoaded, 'rent-zip': rentZipLoaded
  };
  if (newMode===mode && loaded[newMode]) return;
  mode = newMode;
  selectedGeoKey = null;
  ['county','zip','rent-county','rent-zip'].forEach(m => {
    const el = document.getElementById('btn-'+m);
    if (el) el.classList.toggle('active', mode===m);
  });
  const isZipType = mode==='zip' || mode==='rent-zip';
  document.getElementById('geo-label').textContent = isZipType ? 'ZIP CODE' : 'COUNTY';
  document.getElementById('geo-selected-label').textContent = isZipType ? 'Select a zip code...' : 'Select a county...';
  document.getElementById('geo-box').classList.add('placeholder');
  document.getElementById('main-layout').style.display = 'none';
  document.getElementById('empty-state-msg').style.display = '';
  document.getElementById('export-bar').style.display = 'none';
  document.getElementById('summary-sentence').style.display = 'none';
  buildMetricList();
  if (!loaded[mode]) loadDataset(mode);
  else refreshGeoList();
}

// ── Geo list ───────────────────────────────────────────────────────────────
function curMap() {
  if (mode==='county') return countyMap;
  if (mode==='zip') return zipMap;
  if (mode==='rent-county') return rentCountyMap;
  return rentZipMap;
}
function curData() {
  if (mode==='county') return countyDataMap;
  if (mode==='zip') return zipDataMap;
  if (mode==='rent-county') return rentCountyDataMap;
  return rentZipDataMap;
}

function refreshGeoList() {
  let entries = Array.from(curMap().entries()).map(([key,name])=>({key,name}));
  filteredGeoList = entries.sort((a,b)=>a.name.localeCompare(b.name));
  renderGeoList(filteredGeoList);
}

function renderGeoList(list) {
  const c = document.getElementById('geo-list'); c.innerHTML = '';
  const shown = list.slice(0,150);
  if (!shown.length) { c.innerHTML = '<div class="dropdown-empty">No results</div>'; return; }
  shown.forEach(item => {
    const div = document.createElement('div');
    div.className = 'dropdown-item'+(item.key===selectedGeoKey?' active':'');
    div.innerHTML = '<span>'+item.name+'</span><span class="sub">'+item.key+'</span>';
    div.onclick = () => selectGeo(item.key, item.name);
    c.appendChild(div);
  });
  if (list.length>150) c.innerHTML += '<div class="dropdown-empty">+'+(list.length-150)+' more — type to filter</div>';
}

function filterGeoList() {
  const q = document.getElementById('geo-search').value.toLowerCase();
  const all = Array.from(curMap().entries()).map(([key,name])=>({key,name})).sort((a,b)=>a.name.localeCompare(b.name));
  filteredGeoList = q ? all.filter(c=>c.name.toLowerCase().includes(q)||c.key.includes(q)) : all;
  renderGeoList(filteredGeoList);
}

function selectGeo(key, name) {
  selectedGeoKey = key;
  document.getElementById('geo-box').classList.remove('placeholder');
  document.getElementById('geo-selected-label').textContent = name;
  document.getElementById('geo-dropdown').style.display = 'none';
  document.getElementById('export-bar').style.display = 'flex';
  buildSummarySentence();
  renderGeoList(filteredGeoList);
  renderContent();
}

// ── Location filter ────────────────────────────────────────────────────────



// ── Dropdowns ──────────────────────────────────────────────────────────────
function toggleDropdown(which) {
  const dd = document.getElementById(which+'-dropdown');
  ['geo','metric'].forEach(w => {
    if (w!==which) document.getElementById(w+'-dropdown').style.display = 'none';
  });
  const open = dd.style.display !== 'none';
  dd.style.display = open ? 'none' : 'flex';
  if (!open && which==='geo') {
    document.getElementById('geo-search').value = '';
    filterGeoList();
    setTimeout(() => document.getElementById('geo-search').focus(), 50);
  }
}
document.addEventListener('click', e => {
  ['geo','metric'].forEach(w => {
    const wr = document.getElementById(w+'-wrapper');
    if (wr && !wr.contains(e.target)) document.getElementById(w+'-dropdown').style.display = 'none';
  });
});

// ── Metric list ────────────────────────────────────────────────────────────
function buildMetricList() {
  const list = document.getElementById('metric-list');
  list.innerHTML = ''; // always rebuild since list changes by mode
  const metrics = isRentMode() ? RENT_METRICS : METRICS;
  // Reset metric selection when switching to/from rent
  if (isRentMode() && selectedMetric && !RENT_METRICS.find(m=>m.key===selectedMetric.key)) {
    selectedMetric = null;
    document.getElementById('metric-label').textContent = 'Select a metric...';
    document.getElementById('metric-label').style.color = 'var(--subtle)';
    document.getElementById('metric-box').classList.add('placeholder');
  }
  if (!isRentMode() && selectedMetric && !METRICS.find(m=>m.key===selectedMetric.key)) {
    selectedMetric = null;
    document.getElementById('metric-label').textContent = 'Select a metric...';
    document.getElementById('metric-label').style.color = 'var(--subtle)';
    document.getElementById('metric-box').classList.add('placeholder');
  }
  metrics.forEach(m => {
    const div = document.createElement('div');
    div.className = 'dropdown-item'+(selectedMetric&&m.key===selectedMetric.key?' active':'');
    div.textContent = m.label;
    div.onclick = () => {
      selectedMetric = m;
      document.getElementById('metric-label').textContent = m.label;
      document.getElementById('metric-label').style.color = '';
      document.getElementById('metric-box').classList.remove('placeholder');
      document.getElementById('metric-dropdown').style.display = 'none';
      document.querySelectorAll('#metric-list .dropdown-item').forEach(el =>
        el.classList.toggle('active', el.textContent===m.label));
      if (selectedGeoKey) renderContent();
    };
    list.appendChild(div);
  });
}

// ── Render ─────────────────────────────────────────────────────────────────
function renderContent() {
  if (!selectedMetric) return;
  const rows = (curData().get(selectedGeoKey)||[])
    .filter(r => r[selectedMetric.key]!==null && r[selectedMetric.key]!==undefined && r[selectedMetric.key]!=='');
  const chartData = rows.map(r => ({ date: formatDate(r.month_date_yyyymm), value: +r[selectedMetric.key] }));
  const displayName = curMap().get(selectedGeoKey) || selectedGeoKey;

  if (!chartData.length) {
    document.getElementById('main-layout').style.display = '';
    document.getElementById('empty-state-msg').style.display = 'none';
    document.getElementById('chart-panel').innerHTML =
      '<div class="empty-state" style="height:300px;display:flex;align-items:center;justify-content:center;">No data for <strong style="color:var(--text)">'+selectedMetric.label+'</strong> in '+displayName+'</div>';
    return;
  }

  const values = chartData.map(d=>d.value);
  const minVal = Math.min(...values), maxVal = Math.max(...values);
  const avgVal = values.reduce((a,b)=>a+b,0)/values.length;
  const latest = values[values.length-1];
  const colors = values.map(v => {
    if (maxVal===minVal) return '#38bdf8';
    const t = (v-minVal)/(maxVal-minVal);
    return 'rgb('+Math.round(30+t*26)+','+Math.round(77+t*112)+','+Math.round(107+t*141)+')';
  });
  const n = chartData.length;
  const tickStep = n>60 ? Math.floor(n/18) : n>24 ? 4 : 2;

  // Show layout, hide empty state
  document.getElementById('main-layout').style.display = '';
  document.getElementById('empty-state-msg').style.display = 'none';
  buildSummarySentence();

  // Update chart panel
  document.getElementById('chart-panel').innerHTML =
    '<div class="chart-card">' +
      '<div class="chart-title">'+selectedMetric.label+'</div>' +
      '<div class="chart-subtitle">'+displayName+' · '+chartData.length+' months</div>' +
      '<div class="chart-wrap"><canvas id="main-chart"></canvas></div>' +
      '<div class="stats-row">' +
        '<div><div class="stat-label">LATEST</div><div class="stat-value">'+formatValue(latest,selectedMetric.format)+'</div></div>' +
        '<div><div class="stat-label">MIN</div><div class="stat-value">'+formatValue(minVal,selectedMetric.format)+'</div></div>' +
        '<div><div class="stat-label">MAX</div><div class="stat-value">'+formatValue(maxVal,selectedMetric.format)+'</div></div>' +
        '<div><div class="stat-label">AVG</div><div class="stat-value">'+formatValue(avgVal,selectedMetric.format)+'</div></div>' +
      '</div>' +
    '</div>';

  if (chartInstance) { chartInstance.destroy(); chartInstance = null; }
  chartInstance = new Chart(document.getElementById('main-chart').getContext('2d'), {
    type: 'bar',
    data: { labels: chartData.map(d=>d.date), datasets: [{ data: values, backgroundColor: colors, borderRadius: 3, borderSkipped: false }] },
    options: {
      responsive: true, maintainAspectRatio: false, animation: { duration: 300 },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor:'#0f1117', borderColor:'#2a2d3a', borderWidth:1,
          titleColor:'#94a3b8', bodyColor:'#38bdf8',
          titleFont:{family:"'DM Mono',monospace",size:11},
          bodyFont:{family:"'DM Mono',monospace",size:13,weight:'500'},
          padding:10,
          callbacks:{ title:items=>items[0].label, label:item=>formatValue(item.raw,selectedMetric.format) }
        }
      },
      scales: {
        x: { grid:{display:false}, border:{color:'#2a2d3a'},
          ticks:{color:'#475569',font:{family:"'DM Mono',monospace",size:10},maxRotation:45,
            callback:function(val,i){return i%tickStep===0?this.getLabelForValue(val):'';}} },
        y: { grid:{color:'#1a1e2e'}, border:{display:false},
          ticks:{color:'#475569',font:{family:"'DM Mono',monospace",size:10},
            callback:v=>formatValue(v,selectedMetric.format)} }
      }
    }
  });
}



function buildSummarySentence() {
  if (!selectedGeoKey) return;
  const data = curData().get(selectedGeoKey) || [];
  if (!data.length) return;
  const row = data[data.length - 1];
  const displayName = curMap().get(selectedGeoKey) || selectedGeoKey;

  function monthLabel(yyyymm) {
    const s = String(yyyymm);
    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    return months[parseInt(s.slice(4,6),10)-1] + ' ' + s.slice(0,4);
  }

  function dirSpan(val) {
    if (val === null || val === undefined || val === '') return '';
    const pct = (val * 100).toFixed(1);
    const dir = val >= 0 ? 'up' : 'down';
    const color = val >= 0 ? '#4ade80' : '#f87171';
    return dir + ' <strong style="color:'+color+'">'+Math.abs(pct)+'%</strong>';
  }

  const date = row.month_date_yyyymm;
  const curMonth = monthLabel(date);
  // Last year same month
  const lyYYYYMM = (parseInt(String(date).slice(0,4)) - 1) + String(date).slice(4);
  const lyMonth = monthLabel(lyYYYYMM);

  if (isRentMode()) {
    const zori = row.zori !== null && row.zori !== undefined ? '$'+Number(row.zori).toLocaleString(undefined,{maximumFractionDigits:0}) : 'N/A';
    const yyVal = row.zori_yy;
    const yyStr = yyVal !== null && yyVal !== undefined && yyVal !== '' ? dirSpan(yyVal) : '<span style="color:var(--muted)">N/A</span>';
    const el = document.getElementById('summary-sentence');
    el.innerHTML = '<span style="color:var(--accent);font-weight:500;">Rent Summary — '+displayName+'</span>: ' +
      'As of <strong style="color:var(--text)">'+curMonth+'</strong>, ' +
      'the typical observed market rent (ZORI) is <strong style="color:var(--text)">'+zori+'</strong>, ' +
      yyStr+' relative to <strong style="color:var(--text)">'+lyMonth+'</strong>.';
    el.style.display = 'block';
    return;
  }
  const avgYY  = row.average_listing_price_yy;
  const domYY  = row.median_days_on_market_yy;
  const totYY  = row.total_listing_count_yy;

  const avgStr = avgYY  !== null && avgYY  !== undefined && avgYY  !== '' ? dirSpan(avgYY)  : '<span style="color:var(--muted)">N/A</span>';
  const domStr = domYY  !== null && domYY  !== undefined && domYY  !== '' ? dirSpan(domYY)  : '<span style="color:var(--muted)">N/A</span>';
  const totStr = totYY  !== null && totYY  !== undefined && totYY  !== '' ? dirSpan(totYY)  : '<span style="color:var(--muted)">N/A</span>';

  const sentence =
    '<span style="color:var(--accent);font-weight:500;">Real Estate Summary — '+displayName+'</span>: ' +
    'As of <strong style="color:var(--text)">'+curMonth+'</strong>, ' +
    'the average listing price is '+avgStr+', ' +
    'median days on market is '+domStr+', ' +
    'and total listings are '+totStr+' ' +
    'relative to <strong style="color:var(--text)">'+lyMonth+'</strong>.';

  const el = document.getElementById('summary-sentence');
  el.innerHTML = sentence;
  el.style.display = 'block';
}

// ── Export ─────────────────────────────────────────────────────────────────
function getLatestRow() {
  const data = curData().get(selectedGeoKey) || [];
  // data is already sorted ascending, so last item is most recent
  return data[data.length - 1] || null;
}

function getLatestValues() {
  const row = getLatestRow();
  if (!row) return [];
  return METRICS.map(m => ({
    label: m.label,
    key: m.key,
    format: m.format,
    value: row[m.key] !== undefined && row[m.key] !== null && row[m.key] !== '' ? row[m.key] : null
  }));
}

function exportCSV() {
  const row = getLatestRow();
  const displayName = curMap().get(selectedGeoKey) || selectedGeoKey;
  const date = row ? formatDate(row.month_date_yyyymm) : '';
  const lines = ['Location,Date,Metric,Value,YY_Change'];
  REPORT_METRICS.forEach(m => {
    const val = (row && row[m.key] !== null && row[m.key] !== undefined && row[m.key] !== '') ? row[m.key] : '';
    const yval = (row && row[m.yy] !== null && row[m.yy] !== undefined && row[m.yy] !== '') ? row[m.yy] : '';
    lines.push(['"'+displayName+'"', date, '"'+m.label+'"', val, yval].join(','));
  });
  const blob = new Blob([lines.join('\n')], { type: 'text/csv' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = (displayName + '_' + date + '_overview.csv').replace(/[^a-zA-Z0-9_-]/g,'_');
  a.click();
}

const REPORT_METRICS = [{"key": "median_listing_price", "label": "Median Listing Price", "format": "currency", "yy": "median_listing_price_yy"}, {"key": "active_listing_count", "label": "Active Listing Count", "format": "number", "yy": "active_listing_count_yy"}, {"key": "median_days_on_market", "label": "Days on Market", "format": "number", "yy": "median_days_on_market_yy"}, {"key": "new_listing_count", "label": "New Listing Count", "format": "number", "yy": "new_listing_count_yy"}, {"key": "price_increased_count", "label": "Price Increased Count", "format": "number", "yy": "price_increased_count_yy"}, {"key": "price_increased_share", "label": "Price Increased Share", "format": "percent", "yy": "price_increased_share_yy"}, {"key": "price_reduced_count", "label": "Price Reduced Count", "format": "number", "yy": "price_reduced_count_yy"}, {"key": "price_reduced_share", "label": "Price Reduced Share", "format": "percent", "yy": "price_reduced_share_yy"}, {"key": "pending_listing_count", "label": "Pending Listing Count", "format": "number", "yy": "pending_listing_count_yy"}, {"key": "median_listing_price_per_square_foot", "label": "Median Price Per Sq Ft", "format": "currency", "yy": "median_listing_price_per_square_foot_yy"}, {"key": "median_square_feet", "label": "Median Square Feet", "format": "number", "yy": "median_square_feet_yy"}, {"key": "average_listing_price", "label": "Average Listing Price", "format": "currency", "yy": "average_listing_price_yy"}, {"key": "total_listing_count", "label": "Total Listing Count", "format": "number", "yy": "total_listing_count_yy"}, {"key": "pending_ratio", "label": "Pending Ratio", "format": "decimal", "yy": "pending_ratio_yy"}];

function exportJPEG() {
  const row = getLatestRow();
  const displayName = curMap().get(selectedGeoKey) || selectedGeoKey;
  const date = row ? formatDate(row.month_date_yyyymm) : '';

  const cells = REPORT_METRICS.map(m => {
    const val = (row && row[m.key] !== null && row[m.key] !== undefined && row[m.key] !== '') ? row[m.key] : null;
    const yval = (row && row[m.yy] !== null && row[m.yy] !== undefined && row[m.yy] !== '') ? row[m.yy] : null;
    const formatted = val !== null ? formatValue(val, m.format) : 'N/A';
    const yyFormatted = yval !== null ? formatValue(yval, 'percent') : 'N/A';
    const yyColor = yval !== null ? (yval >= 0 ? '#4ade80' : '#f87171') : '#475569';
    return '<div class="sc-cell">' +
      '<div class="sc-cell-label">'+m.label+' (YY%)</div>' +
      '<div class="sc-cell-value">'+formatted+' <span style="font-size:13px;color:'+yyColor+';">('+yyFormatted+')</span></div>' +
    '</div>';
  }).join('');

  const card = document.getElementById('summary-card');
  card.innerHTML =
    '<div class="sc-header">' +
      '<div class="sc-title">'+displayName+'</div>' +
      '<div class="sc-sub">OVERVIEW REPORT &nbsp;&middot;&nbsp; REALTOR.COM INVENTORY DATA</div>' +
      '<div class="sc-date">MOST RECENT DATA: '+date+'</div>' +
    '</div>' +
    '<div class="sc-grid">'+cells+'</div>' +
    '<div class="sc-footer">Generated '+new Date().toUTCString()+' &nbsp;&middot;&nbsp; Source: Realtor.com Research Data</div>';

  card.style.left = '-9999px';
  card.style.display = 'block';

  html2canvas(card, {
    backgroundColor: '#080b12',
    scale: 2,
    useCORS: true,
    logging: false
  }).then(canvas => {
    card.style.display = 'none';
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/jpeg', 0.95);
    a.download = (displayName + '_' + date + '_overview.jpg').replace(/[^a-zA-Z0-9_-]/g,'_');
    a.click();
  });
}

// ── Boot ───────────────────────────────────────────────────────────────────
window.addEventListener('DOMContentLoaded', buildStateGrid);
</script>
</body>
</html>
